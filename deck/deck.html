<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="deck.css" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">

    <script type="text/javascript" src="obs-websocket.js"></script>
    <script type="text/javascript" src="https://loshuevostv.github.io/ovl/webcam_presets.json"></script>

    <script type="text/javascript">
        const obs = new OBSWebSocket();

        obs.connect({
            address: "localhost:4444"
        });

        var webcamSelector = function(sourceid, maincam) {
            var select = document.createElement("select");

            var opt = document.createElement("option");
            opt.value = "";
            opt.innerHTML = "Change";
            select.appendChild(opt);

            for (user in presets) {
                var opt = document.createElement("option");
                opt.value = user;
                opt.innerHTML = presets[user].screen_name;
                select.appendChild(opt);
            }

            select.onchange = function() {
                if (this.value=="") return;

                obs.send('SetSourceSettings', {
                    sourceName: sourceid,
                    sourceSettings: {
                        "url": "https://loshuevostv.github.io/ovl/webcam.html?t=" + this.value
                    }
                });

                if (maincam) {
                    obs.send('SetSourceSettings', {
                        sourceName: sourceid +" Overlay",
                        sourceSettings: {
                            "url": "https://loshuevostv.github.io/ovl/webcam.html?noninja&t=" + this.value
                        }
                    });

                    obs.send('SetSourceSettings', {
                        sourceName: "Main Webcam Overlay (Focus)",
                        sourceSettings: {
                            "url": "https://loshuevostv.github.io/ovl/webcam.html?noninja&t=" + this.value
                        }
                    });
                }
            };

            return select;
        };

        window.onload = function() {
            document.getElementById("webcam-1").appendChild(webcamSelector("Webcam #1", true));

            for (var i = 2; i <= 5; i++) {
                document.getElementById("webcam-"+i).appendChild(webcamSelector("Webcam #"+i, false));
            }

        };
    </script>
  </head>
  <body>
    <div class="deck">
        <div class="deck-webcams">
            <div class="deck-entry"><span>Main Webcam</span><div id="webcam-1"></div></div>
            <div class="deck-entry"><span>Webcam #2</span><div id="webcam-2"></div></div>
            <div class="deck-entry"><span>Webcam #3</span><div id="webcam-3"></div></div>
            <div class="deck-entry"><span>Webcam #4</span><div id="webcam-4"></div></div>
            <div class="deck-entry"><span>Webcam #5</span><div id="webcam-5"></div></div>
        </div>
    </div>

    <div id="webcam-switch-buttons"></div>
  </body>
</html>